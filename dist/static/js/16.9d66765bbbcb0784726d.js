webpackJsonp([16],{F0dZ:function(t,e){},tAJD:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("3cXf"),i=n.n(s),r=n("YUCf"),o=n.n(r),a=n("jOGT"),u=n.n(a),l=n("6ROu"),c=n.n(l),m=n("VKKs"),d=n("oAV5"),f=o.a.Account,h=new o.a.Neb,v=new u.a,p={data:function(){return{questionList:m.a.get(),questionDetail:{},formItem:{},id:"",typeObj:{radio:"单选",checkbox:"多选",textarea:"文本框"},type:[],net:"https://mainnet.nebulas.io",dappAddress:"n1gGz8QkZevfryw2Z3sD48t6xzYThTZgFpC",outdate:!1,record:!1}},mounted:function(){},created:function(){this.switchNet(this.net),this.getQuestionDetail()},methods:{switchNet:function(t){console.error(t),h.setRequest(new o.a.HttpRequest(t))},getQuestionDetail:function(){var t=this,e=this.$route.params.id;this.id=e;var n=f.NewAccount().getAddressString(),s={function:"get",args:i()([e])};this.loading=this.$loading({fullscreen:!0}),h.api.call(n,this.dappAddress,"0","0","1000000","2000000",s).then(function(e){t.loading.close();var n=e.result;"null"!==n?(n=JSON.parse(n),t.questionDetail=n,c()().isBefore(n.date)||(t.outdate=!0),t.getRequiredItem()):t.result=[]}).catch(function(t){return console.log("error:"+t)})},fetchData:function(){for(var t=this.$route.params.id,e=0,n=this.questionList.length;e<n;e++)if(this.questionList[e].num===+t){this.questionDetail=this.questionList[e];break}e===this.questionList.length&&(this.isError=!0)},getRequiredItem:function(){var t=this,e=this.$route.query.record;this.record=e;var n=e&&e.data;console.log(n),this.questionDetail.question.forEach(function(e){"checkbox"===e.type?t.$set(t.formItem,e.num,n&&n[e.num]||[]):t.$set(t.formItem,e.num,n&&n[e.num]||"")})},submit:function(){var t=this,e=this.formItem;if(!this.validate())return this.$message.error("问卷还未填写完成");var n=i()([this.id,e]);this.nebPayCall("answer",n,"0",function(){t.loading=t.$loading({fullscreen:!0,text:"正在查询交易，请等待"})},function(){t.loading.close(),t.title="",t.$message({message:"问卷提交成功",type:"success"}),t.$router.push({path:"/question/list"})})},validate:function(){for(var t in this.formItem)if(0===this.formItem[t].length)return!1;return!0},queryByHash:function(t,e){var n=this;h.api.getTransactionReceipt({hash:t}).then(function(t){console.log(t),0===t.status&&(n.$message.error(t.execute_error),n.loading.close(),clearInterval(n.timer)),2===t.status&&(n.loading=n.$loading({fullscreen:!0,text:"正在查询交易，请等待"})),1===t.status&&(n.loading.close(),console.error("clear",n.timer),clearInterval(n.timer),n.timer=null,e(t))})},nebPayCall:function(t,e,n,s,i){var r=this;if(this.serialNumber=v.call(this.dappAddress,n,t,e,{listener:function(t){if(Object(d.b)()&&t.txhash){var e=t.txhash;r.timer=setInterval(function(){r.queryByHash(e,i),console.error("timer",r.timer)},5e3)}}}),!Object(d.b)())var o=setInterval(function(){r.queryInterval(function(t){clearInterval(o),s(t.hash),r.timer=setInterval(function(){console.error("timer",r.timer),r.queryByHash(t.hash,i)},5e3)})},3e3)},queryInterval:function(t){v.queryPayInfo(this.serialNumber).then(function(e){console.log("tx result: "+e);var n=JSON.parse(e);console.log(n),"success"===n.msg&&t&&t(n.data)}).catch(function(t){console.log("err",t)})}}},g={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.questionDetail?n("div",{staticClass:"content"},[n("div",{staticClass:"question-title"},[t._v(t._s(t.questionDetail.title))]),t._v(" "),t.record?n("div",{staticClass:"question-record"},[n("h2",[t._v("答题详情")]),t._v(" "),n("div",[t._v("\n      被调查人： "+t._s(t.record.author)+"\n    ")])]):t._e(),t._v(" "),t._l(t.questionDetail.question,function(e,s){return n("div",{key:s,staticClass:"question"},[n("p",[t._v("\n      "+t._s(e.num)+"、"+t._s(e.title)+"\n      "),n("span",{staticClass:"question-type"},[t._v("["+t._s(t.typeObj[e.type])+"]")])]),t._v(" "),"radio"===e.type?n("el-radio-group",{model:{value:t.formItem[e.num],callback:function(n){t.$set(t.formItem,e.num,n)},expression:"formItem[question.num]"}},t._l(e.options,function(t){return n("el-radio",{key:t,attrs:{label:t}})})):t._e(),t._v(" "),"checkbox"===e.type?n("el-checkbox-group",{model:{value:t.formItem[e.num],callback:function(n){t.$set(t.formItem,e.num,n)},expression:"formItem[question.num]"}},t._l(e.options,function(t){return n("el-checkbox",{key:t,attrs:{label:t}})})):t._e(),t._v(" "),n("div",{staticClass:"el-textarea"},["textarea"===e.type?n("el-input",{attrs:{type:"textarea"},model:{value:t.formItem[e.num],callback:function(n){t.$set(t.formItem,e.num,n)},expression:"formItem[question.num]"}}):t._e()],1)],1)}),t._v(" "),t.outdate||t.record?t._e():n("div",{staticClass:"submit"},[n("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交")])],1),t._v(" "),t.outdate&&!t.record?n("div",{staticClass:"submit"},[n("p",[t._v("问卷已过期")])]):t._e()],2):t._e()},staticRenderFns:[]};var _=n("vSla")(p,g,!1,function(t){n("F0dZ")},"data-v-590cab06",null);e.default=_.exports}});
//# sourceMappingURL=16.9d66765bbbcb0784726d.js.map